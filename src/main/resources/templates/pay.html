<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/head :: head}"></head>

<body class="active">
<div id="toastContainer" class="toast-container"></div>
<div id="loader" class="spinner-border text-primary" role="status" style="display: none;">
  <span class="sr-only">Loading...</span>
</div>
<div class="wrapper">
  <main class="section">
    <header th:replace="~{fragments/header :: header}"></header>
    <div class="container layout_page">
      <nav aria-label="breadcrumb" style="border-bottom: 2px solid; padding-left: 20px; margin: 20px;">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
          <li class="breadcrumb-item active" aria-current="page"><a href="/forgot-password">Відновлення пароля</a></li>
          <!--                    <li class="breadcrumb-item active" aria-current="page">Current Page</li>-->
        </ol>
      </nav>
      <div class="row">
        <div class="col-md-11 forgot-password-page">


          <h3>Донат</h3><br>

          <form id="wayforpayForm" method="post" action="https://secure.wayforpay.com/pay" accept-charset="utf-8">
            <input type="hidden" name="merchantAccount" id="merchantAccount">
<!--            <input type="hidden" name="merchantAuthType" value="SimpleSignature">-->
            <input type="hidden" name="merchantDomainName" value="www.e-learn.top">
            <input type="hidden" name="returnUrl" value="https://e-learn.top/pay-success">
            <input type="hidden" name="orderReference" id="orderReference">
            <input type="hidden" name="orderDate" id="orderDate">
            <input type="hidden" name="amount" id="amount">
            <input type="hidden" name="currency" value="UAH">
<!--            <input type="hidden" name="orderTimeout" value="49000">-->
            <input type="hidden" name="productName[]" id="productName">
            <input type="text" name="productPrice[]">
            <input type="hidden" name="productCount[]" value="1">
<!--            <input type="hidden" name="clientFirstName" value="Вася">-->
<!--            <input type="hidden" name="clientLastName" value="Пупкин">-->
<!--            <input type="hidden" name="clientAddress" value="пр. Гагарина, 12">-->
<!--            <input type="hidden" name="clientCity" value="Днепропетровск">-->
<!--            <input type="hidden" name="clientEmail" value="some@mail.com">-->
<!--            <input type="hidden" name="defaultPaymentSystem" value="card">-->
            <input type="hidden" name="merchantSignature" id="merchantSignature">
            <button type="submit" id="payment-button">Pay</button>
          </form>



        </div>
      </div>
    </div>
    <div th:replace="~{fragments/menuMobile :: menuMobile}"></div>
  </main>
  <div th:replace="~{fragments/menu :: menu}"></div>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
<!--<script type="text/javascript" th:src="@{/js/forgotPassword.js}"></script>-->
<!--<script type="text/javascript" th:src="@{/js/searchWord.js}"></script>-->
<script>
  $("#payment-button").click(function (event) {
    event.preventDefault();
    var csrfToken = $("meta[name='_csrf']").attr("content");
    var csrfHeader = $("meta[name='_csrf_header']").attr("content");

    var productPrice = [$('#wayforpayForm input[name="productPrice[]"]').val()];
    var productCount = [$('#wayforpayForm input[name="productCount[]"]').val()];


    // Показати Spinner перед відправкою запиту
    $("#loader").show();
    var payment = {
      productPrice: productPrice,
      productCount: productCount
    };
      console.log(payment);
    // Відправка даних на ваш сервер
    $.ajax({
      type: "POST",
      url: "/start-pay",
      contentType: "application/json",
      data: JSON.stringify(payment),
      beforeSend: function (xhr) {
        xhr.setRequestHeader(csrfHeader, csrfToken);
      },
      encode: true,
      success: function (response) {
        console.log(response);
        // Отримали відповідь з сервера
        // Заповнюємо форму з отриманими даними
        $("#merchantAccount").val(response.merchantAccount);
        $("#orderReference").val(response.orderReference);
        $("#orderDate").val(response.orderDate);
        $("#amount").val(response.amount);
        $("#productName").val(response.productName[0]);
        $("#merchantSignature").val(response.merchantSignature);


        // Приховуємо Spinner після отримання відповіді
        $("#loader").hide();

        // Відправляємо форму на Wayforpay
        $("#wayforpayForm").submit();
      },
      error: function () {
        // Обробка помилок
        // Приховуємо Spinner у випадку помилки
        $("#loader").hide();
      },
    });
  });
</script>
</body>
</html>